# Default values for dm-milestone2-chart.
# Multi-component release: frontend, backend, postgres, and shared ingress.

# Number of old ReplicaSets to retain per Deployment
revisionHistoryLimit: 1

# Global image pull secrets
imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Service account configuration
serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext: {}

securityContext: {}

# Frontend configuration
frontend:
  replicaCount: 2
  image:
    repository: ghcr.io/david-maat/linux-web-services-frontend
    tag: latest # Updated by ArgoCD Image Updater
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 8080
  resources: {}
  livenessProbe:
    httpGet:
      path: /
      port: http
  readinessProbe:
    httpGet:
      path: /
      port: http

# Backend configuration
backend:
  replicaCount: 2
  image:
    repository: ghcr.io/david-maat/linux-web-services-backend
    tag: latest # Updated by ArgoCD Image Updater
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 8000
  resources: {}
  livenessProbe:
    httpGet:
      path: /health
      port: http
  readinessProbe:
    httpGet:
      path: /health
      port: http

# pgAdmin configuration
pgadmin:
  image:
    repository: dpage/pgadmin4
    tag: "8.13" # Use published tag; 8.16 missing on Docker Hub
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 80
  adminEmail: admin@example.com
  adminPassword: admin
  server:
    name: Postgres
    group: Servers
    sslmode: prefer
  resources: {}

# Postgres configuration (ephemeral unless persistence enabled)
postgres:
  image:
    repository: postgres
    tag: "15.11-alpine" # Pin to specific patch version
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 5432
  db: postgres
  user: postgres
  password: postgres
  resources: {}
  persistence:
    enabled: true
    size: 1Gi

# Shared ingress routing
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-production"
    nginx.ingress.kubernetes.io/load-balance: "round_robin"
  hosts:
    - host: milestone2.davidmaat.be
      paths:
        - path: /
          pathType: Prefix
          service: frontend
          port: 80
        - path: /user
          pathType: Prefix
          service: backend
          port: 8000
        - path: /container_id
          pathType: Prefix
          service: backend
          port: 8000
        - path: /admin
          pathType: Prefix
          service: pgadmin
          port: 80
  tls:
    - secretName: milestone2-letsencrypt
      hosts:
        - milestone2.davidmaat.be

nodeSelector: {}

tolerations: []

affinity: {}
